<!DOCTYPE html><html lang="zh-cn"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content=" id=&quot;Subject的分类&quot;&gt;&lt;a href=&quot;#Subject的分类&quot; class=&quot;headerlink&quot; title=&quot;Subject的分类&quot;&gt;&lt;/a&gt;Subject的分类&lt;/h1&gt;&lt;p&gt;Subject包含四种类型,BehaviorSubject,AsyncSubject,ReplaySubject,Subject"><link rel="stylesheet" type="text/css" href="/css/normalize.css"><link rel="stylesheet" type="text/css" href="/css/highlight.css"><link rel="stylesheet" type="text/css" href="/css/noise.css"><title>RxJs中的的Subject | Mccc</title><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><meta name="generator" content="Hexo 7.3.0"></head><body><article class="wrapper"><div class="post-main"><div class="nav"><nav class="container"><a class="sidebar-nav-item active" href="/">Home</a><a class="sidebar-nav-item" href="/archives">Archives</a></nav><div class="container post-meta"><div class="post-tags"><a class="post-tag-noise-link" href="/tags/Angular/" rel="tag">Angular</a><a class="post-tag-noise-link" href="/tags/Rxjs/" rel="tag">Rxjs</a></div><div class="post-time">2018-07-16</div></div></div><div class="container post-header"><h1>RxJs中的的Subject</h1></div><div class="container post-toc"><details class="toc"><summary class="toc-accordion"></summary><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Subject%E7%9A%84%E5%88%86%E7%B1%BB"><span class="toc-number">1.</span> <span class="toc-text">Subject的分类</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#BehaviorSubject"><span class="toc-number">1.0.1.</span> <span class="toc-text">BehaviorSubject</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#AsyncSubject"><span class="toc-number">1.0.2.</span> <span class="toc-text">AsyncSubject</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ReplaySubject"><span class="toc-number">1.0.3.</span> <span class="toc-text">ReplaySubject</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Subject"><span class="toc-number">1.0.4.</span> <span class="toc-text">Subject</span></a></li></ol></li></ol></li></ol></details></div><div class="container post-content"><h1 id="Subject的分类"><a href="#Subject的分类" class="headerlink" title="Subject的分类"></a>Subject的分类</h1><p>Subject包含四种类型,BehaviorSubject,AsyncSubject,ReplaySubject,Subject</p>
<h3 id="BehaviorSubject"><a href="#BehaviorSubject" class="headerlink" title="BehaviorSubject"></a>BehaviorSubject</h3><ol>
<li>Observer会接收到BehaviorSubject被订阅之前的最后一个数据，再接收订阅之后发射过来的数据。如果BehaviorSubject被订阅之前没有发送任何数据，则会发送一个默认数据。</li>
</ol>
<div class="noise-code-block" style="--code-block-max-height:inherit;"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">function set_timeout(Observable: any, time: number) &#123;</span><br><span class="line">    setTimeout(() =&gt; &#123;</span><br><span class="line">        Observable.next(time)</span><br><span class="line">    &#125;, time);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">let mySubject = new BehaviorSubject(0);</span><br><span class="line"></span><br><span class="line">mySubject.subscribe(r =&gt; &#123;</span><br><span class="line">    console.log(r)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">set_timeout(mySubject, 3000);</span><br><span class="line"></span><br><span class="line">set_timeout(mySubject, 4000);</span><br><span class="line">    </span><br></pre></td></tr></table></figure></div>
<p>执行结果</p>
<div class="noise-code-block" style="--code-block-max-height:inherit;"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">0</span><br><span class="line">3000</span><br><span class="line">4000</span><br></pre></td></tr></table></figure></div>
<p>在这里0是默认值,如果修改下代码,再订阅之前再发射一个事件</p>
<div class="noise-code-block" style="--code-block-max-height:inherit;"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">function set_timeout(Observable: any, time: number) &#123;</span><br><span class="line">    setTimeout(() =&gt; &#123;</span><br><span class="line">        Observable.next(time)</span><br><span class="line">    &#125;, time);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">let mySubject = new BehaviorSubject(0);</span><br><span class="line"></span><br><span class="line">mySubject.next(1);//订阅之前发射一次事件</span><br><span class="line"></span><br><span class="line">mySubject.next(2);//订阅之前发射一次事件</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mySubject.subscribe(r =&gt; &#123;</span><br><span class="line">    console.log(r)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">set_timeout(mySubject, 3000);</span><br><span class="line"></span><br><span class="line">set_timeout(mySubject, 4000);</span><br><span class="line">    </span><br></pre></td></tr></table></figure></div>
<p>执行结果</p>
<div class="noise-code-block" style="--code-block-max-height:inherit;"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">2</span><br><span class="line">3000</span><br><span class="line">4000</span><br></pre></td></tr></table></figure></div>
<p>这次丢弃了默认值，而发射1。因为BehaviorSubject 每次只会发射调用subscribe()方法之前的最后一个事件和调用subscribe()方法之后的事件。</p>
<ol start="2">
<li>每当新增一个观察者的时候，Subject 能够立即发出当前最新的值，而不是没有任何响应,也就是说如果再次订阅,会获得最新的值。</li>
</ol>
<div class="noise-code-block" style="--code-block-max-height:inherit;"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">function set_timeout(Observable: any, time: number) &#123;</span><br><span class="line">    setTimeout(() =&gt; &#123;</span><br><span class="line">        Observable.next(time)</span><br><span class="line">    &#125;, time);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">let mySubject = new BehaviorSubject(0);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mySubject.subscribe(r =&gt; &#123;</span><br><span class="line">    console.log(r)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">set_timeout(mySubject, 3000);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mySubject.subscribe(r =&gt; &#123;</span><br><span class="line">    console.log(r)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></div>
<p>执行结果</p>
<div class="noise-code-block" style="--code-block-max-height:inherit;"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">0</span><br><span class="line">3000</span><br><span class="line">3000</span><br></pre></td></tr></table></figure></div>


<h3 id="AsyncSubject"><a href="#AsyncSubject" class="headerlink" title="AsyncSubject"></a>AsyncSubject</h3><ol>
<li>Observer会接收AsyncSubject的onComplete()之前的最后一个数据。</li>
</ol>
<div class="noise-code-block" style="--code-block-max-height:inherit;"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">let mySubject = new AsyncSubject();</span><br><span class="line"></span><br><span class="line">mySubject.subscribe(r =&gt; &#123;</span><br><span class="line">  console.log(r)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">mySubject.next(1);</span><br><span class="line"></span><br><span class="line">mySubject.next(2);</span><br><span class="line"></span><br><span class="line">mySubject.complete();</span><br></pre></td></tr></table></figure></div>
<p>执行结果</p>
<div class="noise-code-block" style="--code-block-max-height:inherit;"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2</span><br></pre></td></tr></table></figure></div>
<p>修改下代码</p>
<div class="noise-code-block" style="--code-block-max-height:inherit;"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">let mySubject = new AsyncSubject();</span><br><span class="line"></span><br><span class="line">mySubject.subscribe(r =&gt; &#123;</span><br><span class="line">  console.log(r)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">mySubject.next(1);</span><br><span class="line"></span><br><span class="line">mySubject.complete();</span><br><span class="line"></span><br><span class="line">mySubject.next(2);</span><br></pre></td></tr></table></figure></div>
<p>执行结果</p>
<div class="noise-code-block" style="--code-block-max-height:inherit;"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1</span><br></pre></td></tr></table></figure></div>

<p><em><strong>注意，subject.onComplete()必须要调用才会开始发送数据，否则Subscriber将不接收任何数据</strong></em></p>
<h3 id="ReplaySubject"><a href="#ReplaySubject" class="headerlink" title="ReplaySubject"></a>ReplaySubject</h3><ol>
<li>ReplaySubject会发射所有来自原始Observable的数据给观察者，无论它们是何时订阅的。</li>
</ol>
<div class="noise-code-block" style="--code-block-max-height:inherit;"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">let mySubject = new ReplaySubject();</span><br><span class="line"></span><br><span class="line">mySubject.subscribe(r =&gt; &#123;</span><br><span class="line">  console.log(r)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">mySubject.next(1);</span><br><span class="line"></span><br><span class="line">mySubject.next(2);</span><br><span class="line"></span><br><span class="line">setTimeout(() =&gt; &#123;</span><br><span class="line">  mySubject.subscribe(r =&gt; &#123;</span><br><span class="line">    console.log(r)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;, 1000);</span><br></pre></td></tr></table></figure></div>
<p>执行结果</p>
<div class="noise-code-block" style="--code-block-max-height:inherit;"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">//一秒后</span><br><span class="line">1</span><br><span class="line">2</span><br></pre></td></tr></table></figure></div>
<p>再看一个例子</p>
<div class="noise-code-block" style="--code-block-max-height:inherit;"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">function set_timeout(Observable: any, time: number) &#123;</span><br><span class="line">    setTimeout(() =&gt; &#123;</span><br><span class="line">        Observable.next(time)</span><br><span class="line">    &#125;, time);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">let mySubject = new ReplaySubject();</span><br><span class="line"></span><br><span class="line">mySubject.subscribe(r =&gt; &#123;</span><br><span class="line">  console.log(r)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">mySubject.next(1);</span><br><span class="line"></span><br><span class="line">mySubject.next(2);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">setTimeout(() =&gt; &#123;</span><br><span class="line">  mySubject.subscribe(r =&gt; &#123;</span><br><span class="line">    console.log(r)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;, 1000);</span><br><span class="line"></span><br><span class="line">set_timeout(mySubject, 2000);</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>
<p>执行结果</p>
<div class="noise-code-block" style="--code-block-max-height:inherit;"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">//一秒后</span><br><span class="line">1</span><br><span class="line">2</span><br><span class="line">//两秒后</span><br><span class="line">2000</span><br><span class="line">2000</span><br></pre></td></tr></table></figure></div>

<p>2.同样的,ReplaySubject还接受一个初始参数来规定回放多少个值</p>
<div class="noise-code-block" style="--code-block-max-height:inherit;"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">let mySubject = new ReplaySubject(2);</span><br><span class="line"></span><br><span class="line">mySubject.subscribe(r =&gt; &#123;</span><br><span class="line">  console.log(r)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">mySubject.next(1);</span><br><span class="line"></span><br><span class="line">mySubject.next(2);</span><br><span class="line"></span><br><span class="line">mySubject.next(3);</span><br><span class="line"></span><br><span class="line">setTimeout(() =&gt; &#123;</span><br><span class="line">  mySubject.subscribe(r =&gt; &#123;</span><br><span class="line">    console.log(r)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;, 1000);</span><br></pre></td></tr></table></figure></div>
<p>执行结果</p>
<div class="noise-code-block" style="--code-block-max-height:inherit;"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">//一秒后</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td></tr></table></figure></div>



<h3 id="Subject"><a href="#Subject" class="headerlink" title="Subject"></a>Subject</h3><p>Subject 只接收被订阅之后发送的数据。</p>
<div class="noise-code-block" style="--code-block-max-height:inherit;"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">let mySubject = new Subject();</span><br><span class="line"></span><br><span class="line">mySubject.subscribe(r =&gt; &#123;</span><br><span class="line">  console.log(r)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">mySubject.next(1);</span><br><span class="line"></span><br><span class="line">mySubject.next(2);</span><br></pre></td></tr></table></figure></div>
<p>执行结果</p>
<div class="noise-code-block" style="--code-block-max-height:inherit;"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td></tr></table></figure></div>
<p>如果修改代码</p>
<div class="noise-code-block" style="--code-block-max-height:inherit;"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">let mySubject = new Subject();</span><br><span class="line"></span><br><span class="line">mySubject.next(1);</span><br><span class="line"></span><br><span class="line">mySubject.subscribe(r =&gt; &#123;</span><br><span class="line">  console.log(r)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">mySubject.next(2);</span><br></pre></td></tr></table></figure></div>
<p>结果</p>
<div class="noise-code-block" style="--code-block-max-height:inherit;"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2</span><br></pre></td></tr></table></figure></div>





<p>最后，一句话总结一下四个Subject的特性。</p>
<p>| Subject|特征|<br>|-| :- | :-: | -: |<br>|AsyncSubject|不论订阅发生在什么时候，只会发射最后一个数据|<br>|BehaviorSubject|发送订阅之前一个数据和订阅之后的全部数据|<br>|ReplaySubject|不论订阅发生在什么时候，都发射全部数据|<br>|Subject|发送订阅之后全部数据|</p>

<div id="gitalk-container"></div>
<script src="https://cdn.bootcss.com/blueimp-md5/2.12.0/js/md5.min.js"></script><link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css"><script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>

		<script>
		var gitalkConfig = {"clientID":"Ov23li8ntBo0XKvstJme","clientSecret":"b0fc92ee81f6ee3e9e1e447c6c1f0715d3732681","repo":"hexo-plugin-gitalk","owner":"angelise7","admin":["angelise7"],"distractionFreeMode":false};
	    gitalkConfig.id = md5(location.pathname);
		var gitalk = new Gitalk(gitalkConfig);
	    gitalk.render("gitalk-container");
	    </script></div></div><div class="post-main post-comment"></div></article><link rel="stylesheet" type="text/css" href="/css/third-party/font-awesome/4.5.0/font-awesome.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcdn.net/ajax/libs/lato-font/3.0.0/css/lato-font.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcdn.net/ajax/libs/fancybox/2.1.5/jquery.fancybox.css"><script src="/js/third-party/jquery/2.0.3/jquery.min.js"></script><script src="/js/third-party/fancybox/2.1.5/jquery.fancybox.pack.js"></script><script>$(document).ready(function() {
  $(".fancybox").fancybox();
});
</script></body></html>