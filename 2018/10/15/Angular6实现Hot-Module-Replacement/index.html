<!DOCTYPE html><html lang="zh-cn"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="热模块替换（HMR）是一种WebPack功能，用于更新正在运行的应用程序中的代码而无需重建它。这样可以加快更新速度并减少整页重新加载。"><link rel="stylesheet" type="text/css" href="/css/normalize.css"><link rel="stylesheet" type="text/css" href="/css/highlight.css"><link rel="stylesheet" type="text/css" href="/css/noise.css"><title>Angular6实现HMR(热模块替换) | Mccc</title><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><meta name="generator" content="Hexo 7.3.0"></head><body><article class="wrapper"><div class="post-main"><div class="nav"><nav class="container"><a class="sidebar-nav-item active" href="/">Home</a><a class="sidebar-nav-item" href="/archives">Archives</a></nav><div class="container post-meta"><div class="post-tags"><a class="post-tag-noise-link" href="/tags/Angular/" rel="tag">Angular</a></div><div class="post-time">2018-10-15</div></div></div><div class="container post-header"><h1>Angular6实现HMR(热模块替换)</h1></div><div class="container post-toc"><details class="toc"><summary class="toc-accordion"></summary><ol class="toc"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-HMR%E6%B7%BB%E5%8A%A0%E4%BE%9D%E8%B5%96%E9%A1%B9%E5%B9%B6%E9%85%8D%E7%BD%AEapp"><span class="toc-number">1.</span> <span class="toc-text">1.HMR添加依赖项并配置app</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E9%85%8D%E7%BD%AEHMR%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F"><span class="toc-number">2.</span> <span class="toc-text">2.配置HMR环境变量</span></a></li></ol></details></div><div class="container post-content"><p>热模块替换（HMR）是一种WebPack功能，用于更新正在运行的应用程序中的代码而无需重建它。这样可以加快更新速度并减少整页重新加载。</p>
<p>为了让HMR使用Angular CLI，我们首先需要添加一个新环境并启用它。</p>
<h5 id="1-HMR添加依赖项并配置app"><a href="#1-HMR添加依赖项并配置app" class="headerlink" title="1.HMR添加依赖项并配置app"></a>1.HMR添加依赖项并配置app</h5><ul>
<li>安装hmr依赖环境</li>
</ul>
<div class="noise-code-block" style="--code-block-max-height:inherit;"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install --save-dev @ angularclass / hmr</span><br></pre></td></tr></table></figure></div>

<ul>
<li>创建一个src&#x2F;hmr.ts使用以下内容作为配置</li>
</ul>
<div class="noise-code-block" style="--code-block-max-height:inherit;"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">import &#123; NgModuleRef, ApplicationRef &#125; from &#x27;@angular/core&#x27;;</span><br><span class="line">import &#123; createNewHosts &#125; from &#x27;@angularclass/hmr&#x27;;</span><br><span class="line"></span><br><span class="line">export const hmrBootstrap = (module: any, bootstrap: () =&gt; Promise&lt;NgModuleRef&lt;any&gt;&gt;) =&gt; &#123;</span><br><span class="line">  let ngModule: NgModuleRef&lt;any&gt;;</span><br><span class="line">  module.hot.accept();</span><br><span class="line">  bootstrap().then(mod =&gt; ngModule = mod);</span><br><span class="line">  module.hot.dispose(() =&gt; &#123;</span><br><span class="line">    const appRef: ApplicationRef = ngModule.injector.get(ApplicationRef);</span><br><span class="line">    const elements = appRef.components.map(c =&gt; c.location.nativeElement);</span><br><span class="line">    const makeVisible = createNewHosts(elements);</span><br><span class="line">    ngModule.destroy();</span><br><span class="line">    makeVisible();</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>修改main.ts文件的配置为以下内容</li>
</ul>
<div class="noise-code-block" style="--code-block-max-height:inherit;"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">import &#123; enableProdMode &#125; from &#x27;@angular/core&#x27;;</span><br><span class="line">import &#123; platformBrowserDynamic &#125; from &#x27;@angular/platform-browser-dynamic&#x27;;</span><br><span class="line"></span><br><span class="line">import &#123; AppModule &#125; from &#x27;./app/app.module&#x27;;</span><br><span class="line">import &#123; environment &#125; from &#x27;./environments/environment&#x27;;</span><br><span class="line"></span><br><span class="line">import &#123; hmrBootstrap &#125; from &#x27;./hmr&#x27;;</span><br><span class="line"></span><br><span class="line">if (environment.production) &#123;</span><br><span class="line">  enableProdMode();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const bootstrap = () =&gt; platformBrowserDynamic().bootstrapModule(AppModule);</span><br><span class="line"></span><br><span class="line">if (environment.hmr) &#123;</span><br><span class="line">  if (module[ &#x27;hot&#x27; ]) &#123;</span><br><span class="line">    hmrBootstrap(module, bootstrap);</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    console.error(&#x27;HMR is not enabled for webpack-dev-server!&#x27;);</span><br><span class="line">    console.log(&#x27;Are you using the --hmr flag for ng serve?&#x27;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125; else &#123;</span><br><span class="line">  bootstrap().catch(err =&gt; console.log(err));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h5 id="2-配置HMR环境变量"><a href="#2-配置HMR环境变量" class="headerlink" title="2.配置HMR环境变量"></a>2.配置HMR环境变量</h5><p>创建一个src&#x2F;environments&#x2F;environment.hmr.ts使用以下内容调用的文件：</p>
<div class="noise-code-block" style="--code-block-max-height:inherit;"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">export const environment = &#123;</span><br><span class="line"> production: false,</span><br><span class="line"> hmr: true</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></div>

<p>更新src&#x2F;environments&#x2F;environment.prod.ts并将hmr: false标志添加到环境中：</p>
<div class="noise-code-block" style="--code-block-max-height:inherit;"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">export const environment = &#123;</span><br><span class="line"> production: true,</span><br><span class="line"> hmr: false</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></div>

<p>更新src&#x2F;environments&#x2F;environment.ts并将hmr: false标志添加到环境中：</p>
<div class="noise-code-block" style="--code-block-max-height:inherit;"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">export const environment = &#123;</span><br><span class="line"> production: false,</span><br><span class="line"> hmr: false</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></div>

<p>接下来,配置angular.json,此处 <code>&lt;project-name&gt;</code> 为你的项目名称;</p>
<div class="noise-code-block" style="--code-block-max-height:inherit;"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"> ...</span><br><span class="line"> &quot;projects&quot;:&#123;</span><br><span class="line">   ...</span><br><span class="line">   &quot;build&quot;:&#123;</span><br><span class="line">    ...</span><br><span class="line">    &quot;configurations&quot;:&#123;</span><br><span class="line">      ...</span><br><span class="line">      &quot;hmr&quot;: &#123;</span><br><span class="line">        &quot;fileReplacements&quot;: [&#123;</span><br><span class="line">           &quot;replace&quot;: &quot;src/environments/environment.ts&quot;,</span><br><span class="line">           &quot;with&quot;: &quot;src/environments/environment.hmr.ts&quot;</span><br><span class="line">         &#125;]</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;serve&quot;:&#123;</span><br><span class="line">      ...</span><br><span class="line">      &quot;configurations&quot;:&#123;</span><br><span class="line">        ...</span><br><span class="line">        &quot;hmr&quot;: &#123;</span><br><span class="line">          &quot;hmr&quot;: true,</span><br><span class="line">            &quot;browserTarget&quot;: &quot;&lt;project-name&gt;:build:hmr&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>修改src&#x2F;tsconfig.app.json</p>
<div class="noise-code-block" style="--code-block-max-height:inherit;"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  ...</span><br><span class="line">  &quot;compilerOptions&quot;: &#123;</span><br><span class="line">    ...</span><br><span class="line">    &quot;types&quot;: [&quot;node&quot;]</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>我们可以在pack.json中做以下配置方便我们在实际开发中更好的工作,这里使用4205端口,是方便我们启动多个项目时,防止端口重复,可以根据自己的需要具体修改配置,以下仅供参考;</p>
<div class="noise-code-block" style="--code-block-max-height:inherit;"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&quot;scripts&quot;: &#123;</span><br><span class="line">  ...</span><br><span class="line">  &quot;hmr&quot;: &quot;ng serve --configuration hmr  --open  --port 4205&quot;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure></div>

<div class="noise-code-block" style="--code-block-max-height:inherit;"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm run hmr</span><br></pre></td></tr></table></figure></div></div></div><div class="post-main post-comment"><div id="giscus_thread"></div><script src="https://giscus.app/client.js"
        data-repo="angelise7/blog-comments"
        data-repo-id="R_kgDOPQr6lw"
        data-category=""
        data-category-id=""
        data-mapping="pathname"
        data-strict="0"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="bottom"
        data-theme="light"
        data-lang="en"
        data-loading="lazy"
        crossorigin="anonymous"
        async>
</script></div></article><link rel="stylesheet" type="text/css" href="/css/third-party/font-awesome/4.5.0/font-awesome.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcdn.net/ajax/libs/lato-font/3.0.0/css/lato-font.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcdn.net/ajax/libs/fancybox/2.1.5/jquery.fancybox.css"><script src="/js/third-party/jquery/2.0.3/jquery.min.js"></script><script src="/js/third-party/fancybox/2.1.5/jquery.fancybox.pack.js"></script><script>$(document).ready(function() {
  $(".fancybox").fancybox();
});
</script></body></html>