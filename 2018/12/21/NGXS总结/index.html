<!DOCTYPE html><html lang="zh-cn"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content=" id=&quot;1-Ngxs&quot;&gt;&lt;a href=&quot;#1-Ngxs&quot; class=&quot;headerlink&quot; title=&quot;1.Ngxs&quot;&gt;&lt;/a&gt;1.Ngxs&lt;/h3&gt;&lt;p&gt;在介绍Ngxs之前我们先来了解一下另外一个在Angular项目中用于做状态管理的解决方案;Ngrx,Ngrx的设计灵感来源于Redux,并且使用Rxjs来实现.但是由于Ngrx过于臃肿,在本就庞大的Angular中引入这么一套方案,确实不是很合理,所以就有人在Ngrx的基础上做了减法,诞生了Ngxs.&lt;br&gt;这里就不过多解释为什么需要使用状态管理.只是针对我们在使用Ngxs的过程中异步的问题和解决方案."><link rel="stylesheet" type="text/css" href="/css/normalize.css"><link rel="stylesheet" type="text/css" href="/css/highlight.css"><link rel="stylesheet" type="text/css" href="/css/noise.css"><title>Ngxs使用总结 | Mccc</title><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><meta name="generator" content="Hexo 7.3.0"></head><body><article class="wrapper"><div class="post-main"><div class="nav"><nav class="container"><a class="sidebar-nav-item active" href="/">Home</a><a class="sidebar-nav-item" href="/archives">Archives</a></nav><div class="container post-meta"><div class="post-tags"><a class="post-tag-noise-link" href="/tags/Angular/" rel="tag">Angular</a></div><div class="post-time">2018-12-21</div></div></div><div class="container post-header"><h1>Ngxs使用总结</h1></div><div class="container post-toc"><details class="toc"><summary class="toc-accordion"></summary><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-Ngxs"><span class="toc-number">1.</span> <span class="toc-text">1.Ngxs</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-Ngxs%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5"><span class="toc-number">2.</span> <span class="toc-text">2.Ngxs核心概念</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-Ngxs%E4%BD%BF%E7%94%A8"><span class="toc-number">3.</span> <span class="toc-text">3.Ngxs使用</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A1%A5%E5%85%85select"><span class="toc-number">3.1.</span> <span class="toc-text">补充select</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E8%BF%99%E9%87%8C%E5%8F%AF%E4%BB%A5%E4%BD%BF%E7%94%A8Redux%E7%9A%84%E4%B8%80%E6%AC%BE%E6%8F%92%E4%BB%B6%E6%9D%A5%E5%8D%8F%E5%8A%A9%E5%BC%80%E5%8F%91-%E6%8F%90%E5%8D%87%E5%BC%80%E5%8F%91%E6%95%88%E7%8E%87"><span class="toc-number">3.2.</span> <span class="toc-text">2. 这里可以使用Redux的一款插件来协助开发,提升开发效率</span></a></li></ol></li></ol></details></div><div class="container post-content"><h3 id="1-Ngxs"><a href="#1-Ngxs" class="headerlink" title="1.Ngxs"></a>1.Ngxs</h3><p>在介绍Ngxs之前我们先来了解一下另外一个在Angular项目中用于做状态管理的解决方案;Ngrx,Ngrx的设计灵感来源于Redux,并且使用Rxjs来实现.但是由于Ngrx过于臃肿,在本就庞大的Angular中引入这么一套方案,确实不是很合理,所以就有人在Ngrx的基础上做了减法,诞生了Ngxs.<br>这里就不过多解释为什么需要使用状态管理.只是针对我们在使用Ngxs的过程中异步的问题和解决方案.</p>
<h3 id="2-Ngxs核心概念"><a href="#2-Ngxs核心概念" class="headerlink" title="2.Ngxs核心概念"></a>2.Ngxs核心概念</h3><ul>
<li>Store: 全局状态容器，操作调度程序和选择器</li>
<li>Actions: 描述要采取的操作及其关联元数据的类</li>
<li>State: 状态的类定义</li>
<li>Selects: 状态选择器</li>
</ul>
<p><img src="/images/ngxs/1.png" alt="upload successful"></p>
<p>这里也有一个很简单的demo,基本上看一遍就能很快的清楚Ngxs的实现原理<br><a target="_blank" rel="noopener" href="https://stackblitz.com/edit/ngxs-simple">https://stackblitz.com/edit/ngxs-simple</a></p>
<h3 id="3-Ngxs使用"><a href="#3-Ngxs使用" class="headerlink" title="3.Ngxs使用"></a>3.Ngxs使用</h3><ol>
<li>定义接口数据类型</li>
</ol>
<div class="noise-code-block" style="--code-block-max-height:inherit;"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">interface  Book &#123;</span><br><span class="line">  name:string,//名称</span><br><span class="line">  intro:string,//简介</span><br><span class="line">  category:number,//类别</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">enum category &#123;</span><br><span class="line"> autobiography=1,</span><br><span class="line"> novel=2,</span><br><span class="line"> tool=3,</span><br><span class="line"> other=4,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<ol start="2">
<li>定义model数据类型</li>
</ol>
<div class="noise-code-block" style="--code-block-max-height:inherit;"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">interface BookModel &#123;</span><br><span class="line">  bookList: Book[],</span><br><span class="line">  count: number,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>


<ol start="3">
<li>定义action和state</li>
</ol>
<div class="noise-code-block" style="--code-block-max-height:inherit;"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">class Addbook &#123;</span><br><span class="line">    static readonly type = &#x27;addbook&#x27;;</span><br><span class="line">    constructor(public params: Books) &#123; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class GetBookList&#123;</span><br><span class="line">   static readonly type = &#x27;getBookList&#x27;;</span><br><span class="line">   constructor()&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<div class="noise-code-block" style="--code-block-max-height:inherit;"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">@State&lt;BookModel&gt;(&#123;</span><br><span class="line">  name: &#x27;book&#x27;, //名称,确保唯一</span><br><span class="line">  defaults: &#123; //默认值</span><br><span class="line">    bookList: [],</span><br><span class="line">    count: 0,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">export class BooksState&#123;</span><br><span class="line">	@Action(Addbook)</span><br><span class="line">	async addBook(context:StateContext&lt;BookModel&gt;,action:Addbook)&#123;</span><br><span class="line">		try&#123;</span><br><span class="line">			let addBook=await Promise addBook(action.params);</span><br><span class="line">          </span><br><span class="line">			//获取当前最新的值    </span><br><span class="line">			const state = context.getState();</span><br><span class="line">          </span><br><span class="line">			const books = [...state.bookList, addBook];</span><br><span class="line"></span><br><span class="line">			//请求成功</span><br><span class="line">			context.patchState(&#123;</span><br><span class="line">				bookList: bookList,</span><br><span class="line">                count: state.count+1</span><br><span class="line">			&#125;)</span><br><span class="line">		&#125;catch(error)&#123;</span><br><span class="line">			//请求失败</span><br><span class="line">			throw new Error(&#x27;error&#x27;);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">    </span><br><span class="line">    @Action(GetBookList)</span><br><span class="line">    async getBookList(context:StateContext&lt;BookModel&gt;,action:GetBookList)&#123;</span><br><span class="line">    	try&#123;</span><br><span class="line">           	const &#123; result , count &#125; =await Promise getBookList(action.params);</span><br><span class="line"> </span><br><span class="line">			//请求成功</span><br><span class="line">			context.patchState(&#123;</span><br><span class="line">				bookList: result,</span><br><span class="line">                count: count</span><br><span class="line">			&#125;)</span><br><span class="line">        &#125;catch(error)&#123;</span><br><span class="line">			//请求失败</span><br><span class="line">			throw new Error(&#x27;error&#x27;);</span><br><span class="line">		&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<ol start="4">
<li>组件中调用action</li>
</ol>
<ul>
<li>添加图书</li>
</ul>
<div class="noise-code-block" style="--code-block-max-height:inherit;"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">@Component(&#123;...&#125;)</span><br><span class="line">export class AppComponent &#123;</span><br><span class="line"></span><br><span class="line">	constructor()&#123;</span><br><span class="line">    	const newBook=&#123;</span><br><span class="line">			name:&#x27;十万个为什么&#x27;,</span><br><span class="line">			intro:&#x27;儿童读物&#x27;,</span><br><span class="line">            category:4,</span><br><span class="line"> 		&#125;</span><br><span class="line">        	</span><br><span class="line">        this.store.dispatch(new Addbook(newBook))</span><br><span class="line">    		.subscribe( </span><br><span class="line">      			r =&gt; &#123;</span><br><span class="line">				//请求成功,</span><br><span class="line">     			&#125;,</span><br><span class="line">      			e=&gt;&#123;</span><br><span class="line">				//请求失败</span><br><span class="line">     			&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure></div>


<ul>
<li>获取图书列表</li>
</ul>
<div class="noise-code-block" style="--code-block-max-height:inherit;"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">@Component(&#123;...&#125;)</span><br><span class="line">export class AppComponent &#123;</span><br><span class="line"></span><br><span class="line">	@Select(BooksState) bookList$: Observable&lt;Array&lt;Book&gt;&gt;;</span><br><span class="line"></span><br><span class="line">	//or</span><br><span class="line">  </span><br><span class="line">	bookList$: Observable&lt;Array&lt;Book&gt;&gt;;</span><br><span class="line">    </span><br><span class="line">    constructor(private store: Store)&#123;</span><br><span class="line">      this.bookList$=this.store.select(state=&gt;state.book.bookList);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>




<h4 id="补充select"><a href="#补充select" class="headerlink" title="补充select"></a>补充select</h4><ul>
<li>Snapshot<br>可以从store中获取原始值</li>
</ul>
<div class="noise-code-block" style="--code-block-max-height:inherit;"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">const snapshot = this.store.selectSnapshot(state =&gt; state.book.bookList)  //[]</span><br></pre></td></tr></table></figure></div>


<ul>
<li>Memoized<br>根据自定义条件选组合适的数据</li>
</ul>
<div class="noise-code-block" style="--code-block-max-height:inherit;"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">export class BooksState&#123;</span><br><span class="line">	@Selector() </span><br><span class="line">        static novels(state:BookModel) &#123;</span><br><span class="line">        return state.bookList.filter(e =&gt; e.category===1);</span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<div class="noise-code-block" style="--code-block-max-height:inherit;"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">@Component(&#123;...&#125;)</span><br><span class="line">export class AppComponent &#123;</span><br><span class="line">  @Select(BooksState.novels) novels$: Observable&lt;Array&lt;Book&gt;;  </span><br><span class="line"> </span><br><span class="line">  //or</span><br><span class="line">  novels$: Observable&lt;Array&lt;Book&gt;&gt;</span><br><span class="line">  </span><br><span class="line">  constructor(private store: Store) &#123;</span><br><span class="line">     this.novels$ = this.store.select(BooksState.novels);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>






<h4 id="2-这里可以使用Redux的一款插件来协助开发-提升开发效率"><a href="#2-这里可以使用Redux的一款插件来协助开发-提升开发效率" class="headerlink" title="2. 这里可以使用Redux的一款插件来协助开发,提升开发效率"></a>2. 这里可以使用Redux的一款插件来协助开发,提升开发效率</h4><div class="noise-code-block" style="--code-block-max-height:inherit;"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">npm install @ ngxs / devtools-plugin --save-dev </span><br><span class="line"></span><br><span class="line">＃yarn</span><br><span class="line">yarn add @ ngxs / devtools-plugin --dev</span><br></pre></td></tr></table></figure></div>

<div class="noise-code-block" style="--code-block-max-height:inherit;"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">import &#123; NgxsReduxDevtoolsPluginModule &#125; from &#x27;@ngxs/devtools-plugin&#x27;;</span><br><span class="line"></span><br><span class="line">@NgModule(&#123;</span><br><span class="line">  imports: [</span><br><span class="line">    NgxsReduxDevtoolsPluginModule.forRoot()</span><br><span class="line">  ]</span><br><span class="line">&#125;)</span><br><span class="line">export class AppModule &#123;&#125;</span><br></pre></td></tr></table></figure></div></div></div><div class="post-main post-comment"><div id="disqus_thread"></div><script type="text/javascript">
var disqus_shortname = 'MCCC-1';
var disqus_identifier = '2018/12/21/NGXS总结/';
var disqus_title = 'Ngxs使用总结';
var disqus_url = 'http://example.com/2018/12/21/NGXS%E6%80%BB%E7%BB%93/';
(function() {
   var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
   dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
   (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a target="_blank" rel="noopener" href="http://disqus.com" class="dsq-brlink">Blog comments powered by <span class="logo-disqus">Disqus</span></a><div id="giscus_thread"></div><script src="https://giscus.app/client.js"
        data-repo="angelise7/blog-comments"
        data-repo-id="R_kgDOPQr6lw"
        data-category=""
        data-category-id=""
        data-mapping="pathname"
        data-strict="0"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="bottom"
        data-theme="light"
        data-lang="en"
        data-loading="lazy"
        crossorigin="anonymous"
        async>
</script></div></article><link rel="stylesheet" type="text/css" href="/css/third-party/font-awesome/4.5.0/font-awesome.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcdn.net/ajax/libs/lato-font/3.0.0/css/lato-font.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcdn.net/ajax/libs/fancybox/2.1.5/jquery.fancybox.css"><script src="/js/third-party/jquery/2.0.3/jquery.min.js"></script><script src="/js/third-party/fancybox/2.1.5/jquery.fancybox.pack.js"></script><script>$(document).ready(function() {
  $(".fancybox").fancybox();
});
</script></body></html>